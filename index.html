<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منشئ الصور باستخدام Gemini</title>
    <style>
        :root {
            --primary-color: #4e54c8;
            --secondary-color: #8f94fb;
            --text-color: #333;
            --light-color: #f9f9f9;
            --warning-color: #ff9800;
            --error-color: #f44336;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .description {
            color: #666;
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        textarea, input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            min-height: 120px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        textarea:focus, input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        button {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.3s, box-shadow 0.3s;
            display: block;
            margin: 20px auto;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result {
            margin-top: 30px;
            text-align: center;
        }
        
        .image-container {
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .image-container img {
            max-width: 100%;
            display: block;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            color: var(--error-color);
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            background-color: #ffeaea;
            border-radius: 5px;
            display: none;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 14px;
        }
        
        .api-key-container {
            margin-bottom: 20px;
        }
        
        .info-box {
            background-color: #e7f3ff;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="warning">
            <strong>تحذير أمني:</strong> هذا الموقع يستخدم Gemini API مباشرة من العميل مما يعرض مفتاح API للخطر.
            لا تستخدم مفتاح API الحقيقي هنا إلا لأغراض测试ية فقط.
        </div>
        
        <header>
            <h1>منشئ الصور بالذكاء الاصطناعي</h1>
            <p class="description">اصف ما تريد وإنشاء صور مذهلة باستخدام تقنية Gemini من Google</p>
        </header>
        
        <div class="info-box">
            <h3>تم تحديث الكود:</h3>
            <p>تم إصلاح الخطأ "models/gemini-pro is not found" باستخدام النموذج الصحيح (gemini-pro-vision) وطريقة generateContent الصحيحة.</p>
        </div>
        
        <div class="api-key-container">
            <label for="api-key">مفتاح Gemini API (غير آمن):</label>
            <input type="password" id="api-key" placeholder="أدخل مفتاح API هنا (غير موصى به)">
        </div>
        
        <div class="input-group">
            <label for="prompt-input">وصف الصورة:</label>
            <textarea id="prompt-input" placeholder="أدخل وصفاً دقيقاً للصورة التي تريد إنشاءها..."></textarea>
        </div>
        
        <button id="generate-btn">إنشاء الصورة</button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>جاري إنشاء الصورة، يرجى الانتظار...</p>
        </div>
        
        <div class="error" id="error-message"></div>
        
        <div class="result">
            <div class="image-container" id="image-container"></div>
        </div>
        
        <footer>
            <p>تم التطوير باستخدام Gemini API | استخدام غير آمن | للتجربة فقط</p>
        </footer>
    </div>

    <script>
        // تحذير إضافي في console
        console.warn("تحذير أمني: هذا الكود يعرض مفتاح API للخطر. لا تستخدمه للإنتاج.");
        
        document.addEventListener('DOMContentLoaded', function() {
            const generateBtn = document.getElementById('generate-btn');
            const promptInput = document.getElementById('prompt-input');
            const apiKeyInput = document.getElementById('api-key');
            const loadingElement = document.getElementById('loading');
            const errorMessage = document.getElementById('error-message');
            const imageContainer = document.getElementById('image-container');
            
            generateBtn.addEventListener('click', async function() {
                const prompt = promptInput.value.trim();
                const apiKey = apiKeyInput.value.trim();
                
                if (!apiKey) {
                    showError('يرجى إدخال مفتاح API أولاً');
                    return;
                }
                
                if (!prompt) {
                    showError('يرجى إدخال وصف للصورة أولاً');
                    return;
                }
                
                // إظهار حالة التحميل
                loadingElement.style.display = 'block';
                errorMessage.style.display = 'none';
                imageContainer.innerHTML = '';
                generateBtn.disabled = true;
                
                try {
                    // استخدام Gemini API مباشرة من العميل (غير آمن)
                    // استخدام النموذج الصحيح لإنشاء الصور
                    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro-vision:generateContent?key=${apiKey}`;
                    
                    const requestBody = {
                        contents: [{
                            parts: [{
                                text: "أنشئ صورة بناء على هذا الوصف: " + prompt
                            }]
                        }]
                    };
                    
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });
                    
                    const data = await response.json();
                    
                    if (!response.ok) {
                        const errorMsg = data.error?.message || 'فشل في إنشاء الصورة';
                        throw new Error(errorMsg);
                    }
                    
                    // معالجة الاستجابة - هذا يعتمد على هيكل استجابة Gemini الفعلي
                    if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                        const generatedText = data.candidates[0].content.parts[0].text;
                        
                        // إذا كان النص يحتوي على رابط صورة
                        if (generatedText.includes('http')) {
                            // محاولة استخراج رابط الصورة
                            const urlMatch = generatedText.match(/(https?:\/\/[^\s]+)/);
                            if (urlMatch && urlMatch[0]) {
                                const imageUrl = urlMatch[0];
                                displayImage(imageUrl);
                            } else {
                                throw new Error('لم يتم العثور على رابط صورة في الاستجابة');
                            }
                        } else {
                            // إذا لم يتم إنشاء صورة، قد يكون ذلك لأن Gemini Pro Vision لا يدعم إنشاء الصور مباشرة
                            showError('النموذج المستخدم لا يدعم إنشاء الصور مباشرة. جرب وصفاً مختلفاً أو استخدم نموذجاً آخر.');
                            console.log("استجابة API:", generatedText);
                        }
                    } else {
                        throw new Error('استجابة غير متوقعة من API');
                    }
                    
                } catch (err) {
                    showError('حدث خطأ أثناء إنشاء الصورة: ' + err.message);
                    console.error('تفاصيل الخطأ:', err);
                } finally {
                    loadingElement.style.display = 'none';
                    generateBtn.disabled = false;
                }
            });
            
            function displayImage(url) {
                const imgElement = document.createElement('img');
                imgElement.src = url;
                imgElement.alt = 'الصورة المنشأة';
                imgElement.onload = function() {
                    imageContainer.appendChild(imgElement);
                };
                imgElement.onerror = function() {
                    showError('فشل تحميل الصورة، قد يكون الرابط غير صالح');
                };
            }
            
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
            }
        });
    </script>
</body>
</html>
